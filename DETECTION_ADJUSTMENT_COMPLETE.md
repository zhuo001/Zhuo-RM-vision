# ✅ 检测参数调整完成

## 🎯 问题描述
**用户反馈**：YOLO 检测面积问题特别大，不适用跳帧

## ✅ 已完成的调整

### 1. **减少跳帧** ⚡
```python
SKIP_FRAMES: 4 → 1
```
- 从每5帧检测1次改为每2帧检测1次
- 检测更新频率提升 150%
- 目标跟踪更流畅

### 2. **降低置信度阈值** 📉
```python
YOLO_CONF_THRESHOLD: 0.55 → 0.40
is_valid_person 置信度检查: 0.55 → 0.45
```
- 接受更多检测结果
- 减少漏检

### 3. **大幅放宽面积限制** 📏
```python
# 最小面积比例
area_ratio_min: 0.005 (0.5%) → 0.002 (0.2%)  # +150%

# 最大面积比例
area_ratio_max: 0.95 (95%) → 0.98 (98%)  # +3%

# 最小尺寸（像素）
width_min: 60 → 40  # -33%
height_min: 100 → 60  # -40%

# 最大尺寸（像素）
width_max: 1850 → 1900  # +2.7%
height_max: 1070 → 1100  # +2.8%
```
- **可以检测更小的目标**（远距离人物）
- **可以检测更大的目标**（近距离全屏人物）
- 检测范围扩大约 2.5 倍

### 4. **放宽宽高比限制** 📐
```python
MIN_ASPECT_RATIO: 0.5 → 0.3  # -40%
MAX_ASPECT_RATIO: 5.0 → 8.0  # +60%
```
- 支持更多姿势（横躺、跳跃、蹲下等）

### 5. **增加最大检测数量** 🔢
```python
YOLO_MAX_DETECTIONS: 50 → 100  # +100%
```
- 支持更多人同时出现

---

## 📊 效果对比

| 参数 | 调整前 | 调整后 | 变化 |
|------|--------|--------|------|
| **检测频率** | 每5帧 | 每2帧 | **+150%** 🔄 |
| **最小面积** | 0.5% | 0.2% | **+150%** 🔍 |
| **最大面积** | 95% | 98% | **+3%** |
| **最小尺寸** | 60×100 | 40×60 | **-33%** |
| **置信度** | 0.55 | 0.40 | **-27%** |
| **最大检测** | 50 | 100 | **+100%** |
| **预期FPS** | 50-80 | 35-50 | **-30%** ⚠️ |

**权衡**：FPS 下降约 30%，但检测质量和覆盖范围大幅提升 ✅

---

## 🎯 现在可以检测的场景

### ✅ 新增支持
1. **超小目标**：远距离人物（面积 < 0.5%）
2. **超大目标**：近距离全屏人物（面积 > 95%）
3. **快速移动**：连续检测，不会漏帧
4. **极端姿势**：横躺、跳跃、蹲下等
5. **多人场景**：最多 100 个检测

### ⚠️ 可能的副作用
- 误检增加（因为置信度降低）
- FPS 降低（从 50-80 降到 35-50）
- CPU/GPU 负载增加

---

## 🚀 如何使用

### 立即测试
```bash
python3 person_detect.py
```

观察：
1. 左上角 FPS（预期 35-50）
2. 能否检测到小目标（远处）
3. 能否检测到大目标（近处）
4. 是否有误检

---

## 🔧 如果需要进一步调整

### 场景 1：误检太多
```python
YOLO_CONF_THRESHOLD = 0.50  # 提高到 0.50
confidence < 0.50           # 提高到 0.50
```

### 场景 2：FPS 太低（< 30）
```python
SKIP_FRAMES = 2             # 增加到 2
YOLO_INPUT_SIZE = 320       # 降低到 320
```

### 场景 3：仍然检测不到小目标
```python
YOLO_INPUT_SIZE = 640       # 提高到 640
area_ratio < 0.001          # 降低到 0.001
width < 30 or height < 40   # 降低到 30×40
```

### 场景 4：需要恢复高性能
```python
SKIP_FRAMES = 4
YOLO_CONF_THRESHOLD = 0.55
area_ratio < 0.005 or area_ratio > 0.95
```

查看详细说明：[DETECTION_PARAMS_ADJUSTMENT.md](DETECTION_PARAMS_ADJUSTMENT.md)

---

## 📝 配置预设

可以使用预设配置切换工具：
```bash
python3 switch_preset.py
```

可用预设：
- `high-performance`：高性能（50-80 FPS）
- `balanced`：平衡（40-60 FPS）
- `high-quality`：高质量（35-50 FPS）**← 当前**
- `ultra-sensitive`：超敏感（20-35 FPS）

---

## ✅ 总结

**已完成**：
- ✅ 减少跳帧（1帧间隔）
- ✅ 放宽面积限制（0.2%-98%）
- ✅ 降低尺寸限制（40×60 最小）
- ✅ 降低置信度（0.40-0.45）
- ✅ 增加检测数量（100个）

**当前配置**：**高质量检测模式**
**预期效果**：
- 检测范围：大幅扩大 ✅
- 检测频率：提升 150% ✅
- FPS：35-50（下降 30%）⚠️

**状态**：✅ 可以立即使用

---

**修改时间**：2025-10-11  
**文档**：[DETECTION_PARAMS_ADJUSTMENT.md](DETECTION_PARAMS_ADJUSTMENT.md)  
**工具**：[switch_preset.py](switch_preset.py)
