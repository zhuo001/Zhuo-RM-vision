# 检测参数调整说明

## 🔧 最新调整（2025-10-11）

针对"YOLO 检测面积问题特别大，不适用跳帧"的问题，进行了以下调整：

---

## ✅ 已修改的参数

### 1. **跳帧设置**（大幅减少）
```python
# 修改前
SKIP_FRAMES = 4  # 每5帧检测1次

# 修改后
SKIP_FRAMES = 1  # 每2帧检测1次（几乎连续检测）
```
**效果**：检测更新频率提升 2.5 倍，目标跟踪更流畅

### 2. **置信度阈值**（降低）
```python
# 修改前
YOLO_CONF_THRESHOLD = 0.55
confidence < 0.55  # is_valid_person 中

# 修改后
YOLO_CONF_THRESHOLD = 0.40  # 降低15%
confidence < 0.45  # is_valid_person 中降低10%
```
**效果**：接受更多检测结果，减少漏检

### 3. **面积限制**（极度放宽）
```python
# 修改前
area_ratio < 0.005 or area_ratio > 0.95  # 0.5%-95%
width < 60 or height < 100
width > 1850 or height > 1070

# 修改后
area_ratio < 0.002 or area_ratio > 0.98  # 0.2%-98%（放宽2.5倍）
width < 40 or height < 60               # 最小尺寸降低33%
width > 1900 or height > 1100           # 最大尺寸完全放开
```
**效果**：
- 可以检测更小的目标（远距离人物）
- 可以检测更大的目标（近距离全屏人物）
- 面积范围从 0.5%-95% 扩展到 0.2%-98%

### 4. **宽高比限制**（放宽）
```python
# 修改前
MIN_ASPECT_RATIO = 0.5
MAX_ASPECT_RATIO = 5.0

# 修改后
MIN_ASPECT_RATIO = 0.3  # 降低40%
MAX_ASPECT_RATIO = 8.0  # 提高60%
```
**效果**：支持更多姿势（横躺、跳跃等极端姿势）

### 5. **最大检测数量**（增加）
```python
# 修改前
YOLO_MAX_DETECTIONS = 50

# 修改后
YOLO_MAX_DETECTIONS = 100  # 翻倍
```
**效果**：支持更多人同时出现在画面中

---

## 📊 预期效果对比

| 项目 | 修改前 | 修改后 | 变化 |
|------|--------|--------|------|
| 检测频率 | 每5帧1次 | 每2帧1次 | +150% 🔄 |
| 最小面积 | 0.5% | 0.2% | +150% 🔍 |
| 最大面积 | 95% | 98% | +3% 📏 |
| 置信度阈值 | 0.55 | 0.40 | -27% ⬇️ |
| 最小尺寸 | 60x100 | 40x60 | -33% 📐 |
| FPS | 50-80 | 35-50 | -30% ⚡ |

**注意**：FPS 会下降约 30%（因为检测频率提高），但检测质量和连续性大幅提升。

---

## 🎯 适用场景

### 修改后配置适合：
- ✅ 需要检测**非常小的目标**（远距离人物）
- ✅ 需要检测**非常大的目标**（近距离全屏人物）
- ✅ 目标**移动速度快**，需要连续跟踪
- ✅ 多人场景，需要检测**更多目标**
- ✅ 各种**极端姿势**（躺、跳、蹲等）

### 可能的副作用：
- ⚠️ 误检会增加（因为置信度降低）
- ⚠️ FPS 降低到 35-50（因为检测频率提高）
- ⚠️ CPU/GPU 负载增加

---

## 🔧 如何进一步调整

### 如果误检太多：
```python
YOLO_CONF_THRESHOLD = 0.50  # 提高到0.50
# is_valid_person 中
confidence < 0.50
```

### 如果 FPS 太低（< 30）：
```python
SKIP_FRAMES = 2  # 增加到2（每3帧检测1次）
YOLO_INPUT_SIZE = 320  # 降低分辨率到320
```

### 如果还是检测不到小目标：
```python
YOLO_INPUT_SIZE = 640  # 提高到640（但FPS会降低）
area_ratio < 0.001  # 进一步降低最小面积限制
width < 30 or height < 40  # 降低最小尺寸
```

### 如果还是检测不到大目标：
```python
area_ratio > 0.99  # 接受99%的检测框
width > 2000 or height > 1200  # 完全取消尺寸上限
```

---

## 📝 测试建议

运行程序并观察：

```bash
python3 person_detect.py
```

1. 观察左上角 FPS（预期 35-50）
2. 观察是否能检测到小目标（远处）
3. 观察是否能检测到大目标（近处）
4. 观察是否有误检（非人物被检测）

根据实际情况调整参数。

---

## 🔄 恢复到高性能版本

如果需要恢复到高 FPS（50-80）但检测稍差的配置：

```python
SKIP_FRAMES = 4
YOLO_CONF_THRESHOLD = 0.55
YOLO_MAX_DETECTIONS = 50
area_ratio < 0.005 or area_ratio > 0.95
```

---

**修改时间**：2025-10-11  
**当前配置**：高检测质量模式（牺牲部分性能）  
**预期 FPS**：35-50（从 50-80 降低）  
**检测质量**：大幅提升 ✅
